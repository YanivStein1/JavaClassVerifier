Hi Yaniv,

 

It was great meeting you today. I wanted to provide you with an assignment for the next step. A task that weâ€™ve discussed today ğŸ˜Š

 

Assignment Description:

The goal is to be able to research and implement a POC that shows how we can identify changes in running of Java applications.

 

The input we have is a container that runs a Java application. We would like to create a baseline of approved behavior of this Java application, 
that includes list of classes that the application is running.

We would like to identify any abnormal behavior from the baseline, meaning an application is now running a class that was not used before.

 

The second part of the assignment is to identify cases where an â€œapprovedâ€ class is modified. The use case here is that an attacker replaced a class that is part of the baseline
and we would like to identify these cases.

 

Deliverables:

A working POC that demonstrates three flows:
creating a profiling of approved classes
identifying use of a new class that is not part of the profile
Identifying use of a class that was modified
Documentation of the work done
Ideas for future improvements and additional areas to research
 

Let me know when youâ€™ll be able to complete this task.

Iâ€™ll be happy to answer any questions over phone: 052-6626707

 

Regards,

Amir


×”×™×™ ×××™×¨!
×¦×¨×¤×ª×™ ××ª ×”×¤×ª×¨×•×Ÿ ×©×œ×™ ×œ××ª×’×¨!

×”×¡×‘×¨ ×›×œ×œ×™ (×”×¤×¨×˜×™× ××ª×•×¢×“×™× ×‘source code):
×‘×¢×–×¨×ª ×™×¦×™×¨×ª custom class loader, ×”×¦×œ×—×ª×™ ×œ×ª×¤×•×¡ ×›×œ ×‘×§×©×” ×œ×˜×¢×™× ×” ×©×œ class (×”×‘×§×©×•×ª ×›××•×‘×Ÿ ××ª×‘×¦×¢×•×ª ×¢"×™ ×”-jar ×©××©×ª××© ×‘class loader ×©×œ×™).

×”×¡×‘×¨ ×§×¦×ª ×™×•×ª×¨ ××¢×©×™ ×¢×‘×•×¨ ×”×ª××•× ×” ×”×’×“×•×œ×”:
×™×¦×¨×ª×™ ×©× ×™ classLoaders ××•×ª× ××¤×¢×™×œ ×¢×œ ×§×•×‘×¥ jar ×©×™×™× ×ª×Ÿ ×œ×™ ×›input, ×”×¨××©×•×Ÿ ×™×•×¨×¥ ×œ×–××Ÿ ×§×¦×¨ ××š ×•×¨×§ ×¢×œ ×× ×ª ×œ×™×¦×•×¨ ×¤×¨×•×¤×™×œ ×•×œ××—×¨ ××›×Ÿ ×”××¤×œ×™×§×¦×™×” ×ª×•×¨×¥ ×‘××•×¤×Ÿ ×§×‘×•×¢ ×‘×¢×–×¨×ª ×”classLoader ×”×©× ×™: 
1. ×”classLoader ×”×¨××©×•×Ÿ ×™×ª×¤×•×¡ ×›×œ ×‘×§×©×” ×œ×˜×¢×™× ×” ×©×œ class ×•×™×›×ª×•×‘ ××ª ×©× ×”class ×œ×§×•×‘×¥ ×œ×•×§××œ×™.
2. ×”classLoader ×”×©× ×™ ×™×ª×¤×•×¡ ×›×œ ×‘×§×©×” ×œ×˜×¢×™× ×” ×©×œ class ×•×™×•×•×“× ××œ ××•×œ ×”×§×•×‘×¥ ×©× ×•×¦×¨ ×‘×¡×¢×™×£ ×”×¨××©×•×Ÿ, ×”×× ×”class ×”×•× ×—×œ×§ ××”×¤×¨×•×¤×™×œ ×©×™×¦×¨×ª×™.

×˜×›× ×™×ª ××™×š ×¢×•×©×™× ××ª ×–×”?
×”-input ×©×œ×™ ×”×•× container ×•×§×•×‘×¥ jar. 
×™×© ×œ×›×ª×•×‘  bash script ×©×™×¨×™×¥ ××ª ×”×¤×§×•×“×•×ª ×”×‘××•×ª ×‘×›×“×™ ×œ×”×¤×¢×™×œ ××ª ×©× ×™ ×”-classLoaders.
×›×œ ×¤×§×•×“×” ×ª×¨×™×¥ ××ª ×”-jar ×©× ×™×ª×Ÿ ×œ×™ ×›-input ×™×—×“ ×¢× classLoader ×©×•× ×”:

java -cp ./CustomClassLoader.jar:SimpleApp.jar -Djava.system.class.loader=helloWorld.CustomClassLoader SimpleApp.SimpleMain

java -cp ./CustomClassLoader2.jar:SimpleApp.jar -Djava.system.class.loader=helloWorld.CustomClassLoader SimpleApp.SimpleMain



×—×œ×§ ×©× ×™ ×©×œ ×”×ª×¨×’×™×œ (×•×™×“×•× ×××™× ×•×ª ×ª×•×›×Ÿ ×”-class×™× ×•×œ× ×¨×§ ×¢"×¤ ×©× ×”-class):
×”×¨×¢×™×•×Ÿ ×©×œ×™ ×”×™×” ×œ×‘×¦×¢ ×—×ª×™××” ×§×¨×™×¤×˜×•×’×¨×¤×™×ª ×¢×‘×•×¨ ×›×œ class ×©× ×˜×¢×Ÿ ×‘classLoader ×”×¨××©×•×Ÿ, ×•×œ×•×•×“× ××ª ×”×—×ª×™××” ×”×–×• ×‘classLoader ×”×©× ×™.
×ª×•×š ×›×“×™ ×ª×™×§×•× ×™× ××—×¨×•× ×™× ×‘×§×•×“, ×”×‘× ×ª×™ ×©×’× ×× ×”×¨×¢×™×•×Ÿ ×”×–×” ×¢×•×‘×“, ×–×• ×›× ×¨××” ×œ× ×”×“×¨×š ×œ×¢×©×•×ª ×–××ª. (×™×© ×“×‘×¨×™× ×©×× ×™ ×›× ×¨××” ×œ× ×”×—×›× ×”×¨××©×•×Ÿ ×©×—×©×‘ ×œ×¢×©×•×ª, ××™×©×”×• ×‘×˜×•×— ×›×‘×¨ ×¢×©×” ××ª ×–×”).
×× ×™ ×“×™×™ ×‘×˜×•×— ×©×‘×¢×–×¨×ª java ××•×›×œ ×œ×‘×¦×¢ ×—×ª×™××” ×¢×œ class×™× ××‘×œ×™ ×œ×××© ××ª ×–×” ×‘×¢×¦××™, ×”×’×¢×ª×™ ×œ××¡×§× ×” ×”×–×• ×›×©×”×“×¤×¡×ª×™ ××ª ×”××©×ª× ×” protectionDomain ×¢×‘×•×¨ class ××¡×•×™×™×:
ProtectionDomain  (file:/Users/yanivstein/Desktop/aaa/SimpleApp.jar <no signer certificates>)
 jdk.internal.loader.ClassLoaders$AppClassLoader@4f8e5cde
 <no principals>
 java.security.Permissions@725bef66 (
 ("java.io.FilePermission" "/Users/yanivstein/Desktop/aaa/SimpleApp.jar" "read")
 ("java.lang.RuntimePermission" "exitVM")
)





×•×œ×›×Ÿ, ××‘×—×™× ×ª ×›×™×•×•× ×™ ××—×§×¨ × ×•×¡×¤×™×:
1. ×›× ×¨××” ×§×™×™× ×× ×’× ×•×Ÿ java signer certificate for class. ×¦×¨×™×š ×œ×”×‘×™×Ÿ ××” ×–×” ×‘×“×™×•×§  ×•××™×š ××©×ª××©×™× ×‘×–×” ×¢×œ ×× ×ª ×œ×—×ª×•× class×™×.
2. ×œ×‘×“×•×§ ×”×ª× ×”×’×•×ª ×›××©×¨ ×”×§×•×“ ××›×™×œ dynamic class load ×•×œ×”×‘×™×Ÿ ×”×× ×”×§×•×“ ×©×œ×™ ×ª×•×¤×¡ ××ª ×”××§×¨×™× ×”××œ×”.
3. ×œ×”×‘×™×Ÿ ×”×× ×™×© ×¦×•×¨×š ×‘×”×¤×¢×œ×ª ×”×¤×•× ×§×¦×™×•× ×œ×™×•×ª ×©×œ ×”××¤×œ×™×§×¦×™×” ×‘×›×“×™ ×©×›×œ ×”class×™× ×™×˜×¢× ×•.
4. ×”×× ×”×§×•×“ ×©×œ×™ ×ª×•×¤×¡ ××¦×‘ ×‘×• ×§×™×™× class ×¤× ×™××™?
5. ×œ× ×—×¡×¨ ××§×•× ×œ×¡×“×¨ ××ª ×”×§×•×“, ×›×¨×’×¢ ×”×•× ×¨×§ ×‘×¨××” ×©×œ POC :)

× ×ª×¨××” ×‘×™×•× ×¨××©×•×Ÿ,
×™× ×™×‘
